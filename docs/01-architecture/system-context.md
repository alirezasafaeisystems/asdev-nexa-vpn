# System Context (بافت سیستم)

---

## 🏗️ معماری کلی

```
┌─────────────────────────────────────────────────────────────────┐
│                         NexaVPN Platform                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐       │
│  │   Client    │     │   Server    │     │   Worker    │       │
│  │   (Browser) │────▶│   (Next.js) │────▶│   (BullMQ)  │       │
│  └─────────────┘     └──────┬──────┘     └─────────────┘       │
│                             │                                    │
│         ┌───────────────────┼───────────────────┐              │
│         ▼                   ▼                   ▼              │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐       │
│  │  Database   │     │   Redis     │     │  Telegram   │       │
│  │  (SQLite)   │     │  (Queue)    │     │    API      │       │
│  └─────────────┘     └─────────────┘     └─────────────┘       │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘

                    External Services
┌─────────────────────────────────────────────────────────────────┐
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐       │
│  │  Hiddify    │     │  Blockchain │     │   Email     │       │
│  │   Panel     │     │   (Crypto)  │     │   (SMTP)    │       │
│  └─────────────┘     └─────────────┘     └─────────────┘       │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔒 مرزهای اعتماد

| مرز | توضیح | سطح اعتماد |
|-----|-------|------------|
| Browser | کاربر نهایی | ❌ غیرقابل اعتماد |
| API Routes | سرور Next.js | ✅ قابل اعتماد |
| Hiddify API | پنل VPN | ⚠️ نیاز به احراز هویت |
| Telegram | ربات تلگرام | ⚠️ نیاز به secret token |

---

## 📦 کامپوننت‌ها

### 1. Frontend (Next.js App Router)
- **تکنولوژی:** React 19, TypeScript, Tailwind CSS
- **مسئولیت:** رندر صفحات، تعامل با کاربر
- **فایل‌ها:** `src/app/**/*`

### 2. API Routes (Next.js Route Handlers)
- **تکنولوژی:** Next.js API Routes
- **مسئولیت:** پردازش درخواست‌ها، اعتبارسنجی
- **فایل‌ها:** `src/app/api/**/*`

### 3. Worker Process (BullMQ)
- **تکنولوژی:** BullMQ, Redis
- **مسئولیت:** پردازش پس‌زمینه
- **فایل‌ها:** `mini-services/worker/**/*`

### 4. Database (SQLite/PostgreSQL)
- **تکنولوژی:** Prisma ORM
- **مسئولیت:** ذخیره‌سازی داده‌ها
- **فایل‌ها:** `prisma/schema.prisma`

---

## 🌐 فرآیندها

| Process | پورت | توضیح |
|---------|------|-------|
| Next.js Web | 3000 | سرور اصلی |
| Worker | 3003 | پردازش پس‌زمینه |
| Redis | 6379 | صف پیام |

---

## 🔗 External Dependencies

| سرویس | استفاده | نیاز در MVP |
|-------|---------|-------------|
| Hiddify Panel | مدیریت VPN | ✅ ضروری |
| Telegram Bot | پشتیبانی | ✅ ضروری |
| Redis | صف BullMQ | ⚠️ اختیاری |
| Email SMTP | نوتیفیکیشن | ❌ Post-MVP |
